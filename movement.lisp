;;;; movement.lisp
;;;; Author: Elliot Penson

(in-package :knight-owl)

(defconstant +algebraic-move-re+
  "([RNBQK])?([a-h])?([1-8])?(x)?([a-h])([1-8])(=[RNBQK])?([#+])?"
  "A regular expression that describes chess movement in standard
   algebraic notation")

(defconstant +piece-chars+ '(#\R #\N #\B #\Q #\K #\P))

(defconstant +all-moves+
  (let ((files '("a" "b" "c" "d" "e" "f" "g" "h"))
        (ranks '("1" "2" "3" "4" "5" "6" "7" "8"))
        (capture-sign '("" "x"))
        (check-sign '("" "#" "+")))
    (mapcar (lambda (string-list)
              (format nil "狺篝蜷铉扉篝┅ㄡ痧孱痱镤蹉Ж⒁⑽⒙⒀⑺汜痿躜瀛箝珙骈戾蜥铍汨邈氕箝珙痱镤蹉骈戾蜥铍汜痿躜瀛箝珙Ж⒔尧⒔微⒔垄⒔癣⒔刷汨邈氕箝珙┅┅换痱镤蹉Ж碍阿碍碍阿汨邈氕箝珙ㄤ彐躅痱镤蹉é蝈篝扉篝螬⒚犰沲灬翦翳冕螋弩獒痱镤蹉镦翳轭瘐扉篝螽麒孱扉篝祜镳骘桢徜轭ㄦ轵篝扉篝螬骘翎殪ㄡ痧禊＇痱镤蹉蝈篝扉篝螬殒翎殪狃疱钿磲疸狎灬礅溽翎殪ㄣ镱桢徜翎殪┅翎殪螬屐箦泔祆邈扉篝桢徜┅┅ㄤ彐珏铄蜷痖邈瀛盹鲥痖邈瀛汨狎麒轸屦汜痿躜屦骈钺飙蜥铍ê滹沲礤铘狒轱⑴鲠祯狒弩麸扉篝镦ㄦ殪蜥铍筱犰弩┅ㄤ彐礤翳镤痖邈瀛盹鲥è痖邈瀛汨狎ㄥ耢＼药麒轸屦汜痿躜屦骈钺飙蜥铍⑿蝻鲩溴犰痫篌殁戾蝻镫盹鲥螈Жò暴ò博ò畅ò穿ò旦ò订ò珐ò暴ò博ò畅ò穿ò旦ò订ò珐ū癌ú癌ǔ癌ù癌ǖ癌ǘ癌ǚ癌ō癌ō癌ō癌ō癌ō癌ō癌ō癌┅ㄤ彐礤翳镤痖邈瀛盹鲥è痖邈瀛汨狎ㄥ耢＼惟麒轸屦汜痿躜屦骈钺飙蜥铍⑿蝻鲩溴犰痫篌殁戾腩殓梏盹鲥螈Жō博ū博ō暴ú暴ō暴ú暴ō博ū博┅ㄤ彐礤翳镤痖邈瀛盹鲥è痖邈瀛汨狎ㄥ耢＼漏麒轸屦汜痿躜屦骈钺飙蜥铍⑿蝻鲩溴犰痫篌殁戾忾箬镳盹鲥螈Жō暴ō博ō畅ō穿ō旦ō订ō珐ū暴ú博ǔ畅ù穿ǖ旦ǘ订ǚ珐ū暴ú博ǔ畅ù穿ǖ旦ǘ订ǚ珐ō暴ō博ō畅ō穿ō旦ō订ō珐┅ㄤ彐礤翳镤痖邈瀛盹鲥è痖邈瀛汨狎ㄥ耢＼雪麒轸屦汜痿躜屦骈钺飙蜥铍⑿蝻鲩溴犰痫篌殁戾聃邋盹鲥螈ㄡ痧孱痖邈瀛盹鲥＼麒轸屦汜痿躜屦骈钺飙蜥铍痖邈瀛盹鲥＼麒轸屦汜痿躜屦骈钺飙蜥铍┅ㄤ彐礤翳镤痖邈瀛盹鲥è痖邈瀛汨狎ㄥ耢＼拴麒轸屦汜痿躜屦骈钺飙蜥铍⑿蝻鲩溴犰痫篌殁戾腴铉盹鲥螈Жō暴ò暴ū暴ū癌ū暴ò暴ō暴ō癌┅ㄤ彐礤翳镤痖邈瀛盹鲥è痖邈瀛汨狎汨狎徙翦颟麒轸屦汜痿躜屦骈钺飙蜥铍⑿蝻鲩溴犰痫篌殁戾疳黝盹鲥ㄦ犰翳蝻蹒汜箦换韵南孱疳篌犷ㄩ麒轸屦ㄩ汜痿躜屦Жū暴ō暴ㄩ骈钺飙蜥铍穿Жò暴ò博Жò暴┅ㄩ汜痿躜屦Жō暴ū暴ㄩ骈钺飙蜥铍畅Жò暴ò博Жò暴┅┅ㄤ彐躅汜瞽牾眇痖邈瀛汨狎⒃蝓骘腩殓梏驷祗骘犷雉桢痖邈瀹ㄣ栳颦羼踽痖邈瀛汨狎＼惟ㄤ彐躅汜瞽痱镯雉瀛痖邈蜥铍麒轸屦⒛邈殇弩殒玳鲥痖邈磲忮痱镯雉邃忉箦镱轸豉疱犷痫箝糸镱戾è骈钺飙蜥铍ㄩ麒轸屦铛礅弪镦蜥铍螳┅ㄡ钿ㄣ栳颦羼踽痖邈＼些蜥铍骈钺飙蜥铍┅┅ㄤ彐躅忮轭绛狒翎汶邃ㄦ殪蜥铍怙狎麒轸瀛狒翎汶弪皓⒂遽蜚桢骘犷痖邈弩翳狒泔蹯汜痿躜沐螋衢篑踽蝈箫礤灬礅溽痖邈瀛汨狎盹鲥矧殓轭骈戾蜥铍怙狎痖邈瀛汨狎麒轸瀛狒翎汶弪舂痖邈瀛汨狎螳┅ㄤ彐躅汨邈氕ㄢ镝蜾麒轸屦⒛弭弪黹铄殒翳腴铉轶忮轭狒翎汶邃ㄤ弩趄蹉趱蜷铉忾钿腴铉骈戾腴铉蜥铍痖邈瀛祜汜糸镱ㄩ麒轸屦鳝р氅怙狎洎ㄢ彘铉狒翎汶邃腴铉骈戾腴铉蜥铍怙狎铒麒轸屦┅┅ㄤ彐躅汨邈腠狒瀛ㄢ镝蜾麒轸屦⒛弭弪黹铄殒翳腴铉轶怙翳忮轭狒翎汶邃犷汜铑雉弩汜疱ㄡ钿ㄣ桢汶怙狎麒轸屦铒翎铢灬礅溽盹鲥鲠扉洵盹鲥盹鲥怙狎麒轸屦┅犰飙盹鲥螳┅ㄤ彐躅盹鲥矧殓轭ㄦ轭犰骈戾骈钺飙蜥铍痱瀛怙狎痖邈瀛汨狎麒轸屦汜痿躜屦脲矧殓轭骈戾矧殓轭蜥铍⒂屐邈趔骝镯痖邈濮痫篌殁戾盹鲥翳篝狎糸铉祜汜糸镱忉箦镱溴篝轭狒轱町澡痱瀛怙狎鲠蜷徕戾玳鲥翳灬秕忮骘蝈翳盹鲥祜镳骘ㄦ殪瀛筱犰蜥铍筱犰濠轭痖邈瀛盹鲥痖邈瀛汨狎麒轸屦汜痿躜屦骈钺飙蜥铍狍汜钿殇狒瀛骈戾ǐ骈钺飙骈戾骈戾筱犰濠狍汜钿殇狒瀛蜥铍ǐ骈钺飙蜥铍蜥铍筱犰濠麒孱ㄡ钿ㄩ瞽怙狎洵汜钿殇狒瀛骈戾汜钿殇狒瀛蜥铍ㄥㄧ弭篑踽蝈痱瀛怙狎汜钿殇狒瀛骈戾汜钿殇狒瀛蜥铍痖邈瀛汨狎倔礅镬痖邈瀛汨狎麒轸屦┅矧ㄣ犷牾眇痖邈瀛汨狎铒痖邈弩忮赭邋瞽痱瀛怙狎骈钺飙骈戾骈钺飙蜥铍汜钿殇狒瀛骈戾汜钿殇狒瀛蜥铍┅矧铛祆矧殓轭骈戾矧殓轭骈戾汜钿殇狒瀛骈戾┅矧铛祆矧殓轭蜥铍矧殓轭蜥铍汜钿殇狒瀛蜥铍┅蝈趱蝾扉篝汜钿殇狒瀛骈戾汜钿殇狒瀛蜥铍┅ㄤ彐躅溴篝蝓泗躜瀛盹鲥篝蜷铉盹鲥⒛镥翳溟螋黠螂镦疳蝮轭盹鲥轭犰珏怛衢铒翎糸镱碰犰踽翦麸扉篝镦痖邈矧殓轭骈戾矧殓轭蜥铍汜痿躜屦骈钺飙骈戾骈钺飙蜥铍痱镯雉轱犷汨邈氅ㄦ戾è篝蜷铉俱栳篝蜷铉ㄣ栳篝蜷铉癌┅蝈玳篝弪珧秕痼忾钿痖邈矧殓轭骈戾矧殓轭蜥铍汜痿躜屦骈钺飙骈戾骈钺飙蜥铍痱镯雉轱汨邈氅ǐ犰珏怛衢悱盹鲥蝈篝蜷铉趄轫ㄡ痧孱麒轸弩疳沐汨狎螳Ж＼＼咯篝蜷铉盹鲥┅扉篝ㄩ痖邈篝蜷铉俱栳痖邈濠＼些麒孱矧殓轭骈戾ㄦ殪瀛鹃钿屮篝蜷铉俱栳矧殓轭骈戾┅麒孱矧殓轭蜥铍蜥铍鹃钿屮篝蜷铉俱栳矧殓轭蜥铍┅汜痿躜屦ㄦ殪瀛鹃钿屮篝蜷铉俱栳骈钺飙骈戾┅蜥铍鹃钿屮篝蜷铉俱栳骈钺飙蜥铍┅麒孱痱镯雉轱换汨镲箦痖邈疳螋镦Ы痖邈濮ㄣ栳痱镯雉轱暴汨邈氅┅ㄤ彐躅鲠扉洵汨邈氕箝珙ㄣ桢汶箝珙盹鲥怙狎麒轸屦⑵轭潴秕殒翳汨邈箝珙ㄥ眇豉篝蜷铉栳箬矧痨躞磲翥桢翳翳怙狎洄篝狒徭翦盹鲥轶疱蜴矧礤洚戾è骢趱蝈怙狎磲脲盹鲥盹鲥ㄤ躔扉汜翦怙狎怙狎洎麒轸屦┅ㄡ钿铒ㄣ桢汶骢趱蝈怙狎麒轸屦┅矧ㄡ钿铒汨邈氕箝珙铒ㄣ桢汶骢趱蝈怙狎铒麒轸屦┅┅ㄡ钿篝蜷铉汨邈氕箝珙ㄣ桢汶骢趱蝈怙狎铒麒轸屦┅ㄡ钿篝蜷铉汨邈氕箝珙＂ㄣ桢汶磲翦骢趱蝈怙狎铒麒轸屦┅┅┅ㄤ彐躅鲠扉洵盹鲥盹鲥怙狎麒轸屦⒛弭弪黹铄殒盹鲥汜忮疱蜴矧礤镱玳鲥怙狎洚麒孱ㄤ弩趄蹉趱蝈盹鲥盹鲥ㄤ弩趄蹉趱蜷铉忾钿痖邈矧殓轭蜥铍矧殓轭骈戾汜痿躜屦骈钺飙骈戾骈钺飙蜥铍痱镯雉轱汨邈氅ㄤ弩趄蹉趱蝈盹鲥盹鲥戾è矧殓轭盹鲥矧殓轭骈钺飙骈戾骈钺飙蜥铍怙狎痖邈麒轸屦汜痿躜屦猴蜷玳瞽骈戾矧殓轭骈戾猴蜷玳瞽蜥铍矧殓轭蜥铍┅ㄤ弩糸钺糸镱篑踽蝈ㄧ弭篑踽蝈怙狎骈钺飙骈戾骈钺飙蜥铍┅ㄡ钿矧殓轭ㄩ汜痿躜屦ㄩ麒轸屦ㄢ灬汶痖邈瀛溴篝轭狒轱瞽篑踽蝈麒轸瀛痖邈瀛溴篝轭狒轱瞽篑踽蝈┅铛祆溴篝轭狒轱瞽篑踽蝈┅矧铛祆痱镯雉轱瞟ㄣ犷痱镯雉瀛痖邈骈钺飙蜥铍麒轸屦┅鲠扉洵汨邈氕箝珙汨邈盹鲥怙狎麒轸屦┅┅┅ㄤ彐躅盹鲥骝镯麸ㄢ镝蜾轭轸獒飙骈戾轭轸獒飙蜥铍骈钺飙骈戾骈钺飙蜥铍脲铄鳝痖邈濠⒘漩犷沐箝铉戾痖邈玳鲥犷矧殓轭犷溴篝轭狒轱町澡铄鳝痖邈脲黠蜾疳蜥礤翦磲忮躞邃麸蝈溴骈铄痖邈痱镯雉轱瞟箦翩ㄧ弭篑踽蝈怙狎骈钺飙骈戾骈钺飙蜥铍ㄩ铄鳝痖邈铄鳝痖邈ㄧ弭篑踽蝈怙狎轭轸獒飙骈戾轭轸獒飙蜥铍┅ㄧ弭篑踽蝈怙狎轭轸獒飙骈戾轭轸獒飙蜥铍铋飑ㄤ彐躅磲脲盹鲥盹鲥怙狎麒轸屦⒛弩趄蹉糸鲥禊盹溟骈弩翳怙狎骘翳玳鲥盹鲥澡盹鲥疳蜥礤翦箬秕熹忮篝蜷铉轭犰珏怛衢汨弩铒翎糸镱幸琶衔纳陨衔澡盹鲥轶鲠扉镱翳玳鲥怙狎洚ㄤ弩趄蹉趱蜷铉忾钿痖邈矧殓轭蜥铍矧殓轭骈戾汜痿躜屦骈钺飙骈戾骈钺飙蜥铍痱镯雉轱汨邈氅ㄤ弩趄蹉趱蝈盹鲥盹鲥ㄤ邈灬蝈ㄩ珙矧汨邈氅ㄤ弩趄蹉趱蜷铉忾钿矧殓轭骈戾矧殓轭蜥铍盹鲥矧殓轭骈钺飙骈戾骈钺飙蜥铍怙狎痖邈麒轸屦汜痿躜屦猴蜷玳瞽骈戾矧殓轭骈戾猴蜷玳瞽蜥铍矧殓轭蜥铍盹鲥骝镯麸怙狎矧殓轭骈戾矧殓轭蜥铍骈钺飙骈戾骈钺飙蜥铍侯鬻痖邈麒孱痱镯雉轱痖邈瀛汨狎倔礅镬痱镯雉轱麒轸屦┅┅怙狎洎